{% extends "base.html" %}
{% block content %}
<h2>Lista de Pedidos</h2>
<a class="btn btn-success mb-3" href="{% url 'agregar_pedido' %}">+ Nuevo Pedido</a>
<table class="table table-hover">
  <thead>
    <tr>
      <th>ID</th>
      <th>Usuario</th>
      <th>Fecha</th>
      <th>Estado</th>
      <th>Total</th>
      <th>Productos</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    {% for p in pedidos %}
    <tr>
      <td>{{ p.id }}</td>
      <td>{{ p.usuario.nombre_usuario }}</td>
      <td>{{ p.fecha_pedido|date:"d/m/Y H:i" }}</td>
      <td>{{ p.estado_pedido }}</td>
      <td>${{ p.total_pedido }}</td>
      <td>
        {% for prod in p.productos.all %}
          {{ prod.nombre }}{% if not forloop.last %}, {% endif %}
        {% empty %}
          Sin productos
        {% endfor %}
      </td>
      <td>
        <a class="btn btn-sm btn-info" href="{% url 'actualizar_pedido' p.id %}">Editar</a>
        <a class="btn btn-sm btn-danger" href="{% url 'borrar_pedido' p.id %}">Borrar</a>
      </td>
    </tr>
    {% empty %}
    <tr><td colspan="7">No hay pedidos registrados.</td></tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
